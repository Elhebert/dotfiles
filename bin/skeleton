#!/bin/bash

red=$(tput setaf 1)
green=$(tput setaf 2)
orange=$(tput setaf 3)
reset=$(tput sgr0)

CODEEDITOR="code"

PROJECTNAME=$1

echo "ğŸ”¬  Running checks"

if [ -d "$PROJECTNAME" ]; then
  echo "âŒ ${red}Project directory $PROJECTNAME already exists.${reset}"
  quit
fi

if ! hash php 2>/dev/null; then
  echo "âŒ ${red}PHP is not installed.${reset}"
  quit
fi

if ! hash git 2>/dev/null; then
  echo "âŒ ${red}Git not installed.${reset}"
  quit
fi

echo "ğŸŒ€  Cloning repository..."
git clone git@github.com:Altavia-ACT/laravel-skeleton --branch=master --depth=1 "$PROJECTNAME"

cd "$PROJECTNAME" || exit

echo "âš™ï¸  Initialize new repository"
rm -rf .git
git init
git add .
git commit -m "(feat): Initial commit"

echo "ğŸšš  Running Composer..."
composer install

echo "ğŸ“¦  Running NPM..."
npm install

echo "âœ¨  Finalize installation..."
if [ ! -f .env ]; then
    cp .env.example .env
fi

php artisan key:generate

$CODEEDITOR .

echo "âœ” You are ready to go"
